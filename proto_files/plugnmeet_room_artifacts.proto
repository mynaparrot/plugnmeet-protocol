syntax = "proto3";
package plugnmeet;
option go_package = "github.com/mynaparrot/plugnmeet-protocol/plugnmeet";

enum RoomArtifactType {
  UNKNOWN_ARTIFACT = 0;
  // A meeting summary generated by an AI service.
  MEETING_SUMMARY = 1;
  SPEECH_TO_TEXT = 2;
  CHAT_TRANSLATION = 3;
  TEXT_TO_SPEECH = 4;
  AI_CHAT = 5;
}

// FileInfo contains details about a generated file artifact.
message RoomArtifactFileInfo {
  string file_path = 1;
  int64 file_size = 2;
  string mime_type = 3;
}

// ProviderJobInfo contains details about an asynchronous job sent to a provider.
message RoomArtifactProviderJobInfo {
  string job_id = 1;
  string file_name = 2;
}

// UserInfo contains details about the user associated with an artifact.
message RoomArtifactUserInfo {
  string user_id = 1;
  optional string name = 2;
}

message RoomArtifactTokenUsage {
  uint32 prompt_tokens = 1;
  uint32 completion_tokens = 2;
  uint32 total_tokens = 3;
}

// DurationUsage contains duration usage for a service (e.g., STT).
message RoomArtifactDurationUsage {
  // Duration in seconds.
  uint32 duration_sec = 1;
}

// RoomArtifactMetadata is the universal structure for the 'metadata' JSON field
// in the pnm_room_artifacts table. All fields are optional.
message RoomArtifactMetadata {
  // Optional: Information about the user who initiated or is associated with the artifact.
  RoomArtifactUserInfo user_info = 1;

  // Optional: Information about an asynchronous provider job.
  RoomArtifactProviderJobInfo provider_job_info = 2;

  // Optional: Information about the final generated file artifact.
  RoomArtifactFileInfo file_info = 3;

  // A field for different types of usage metrics.
  oneof usage_details {
    RoomArtifactTokenUsage token_usage = 4;
    RoomArtifactDurationUsage duration_usage = 5;
  }
}

// Webhook-specific Messages
message RoomArtifactWebhookEvent {
  RoomArtifactType type = 1;
  string artifact_id = 2;
  RoomArtifactMetadata metadata = 3;
}
