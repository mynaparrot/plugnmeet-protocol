syntax = "proto3";
package plugnmeet;
option go_package = "github.com/mynaparrot/plugnmeet-protocol/plugnmeet";

enum RoomArtifactType {
  UNKNOWN_ARTIFACT = 0;
  // A meeting summary generated by an AI service.
  MEETING_SUMMARY = 1;
  // A record of a speech-to-text transcription session.
  SPEECH_TRANSCRIPTION = 2;
  // A record of chat message translation usage.
  CHAT_TRANSLATION = 3;
  // A record of a text-to-speech synthesis event.
  SYNTHESIZED_SPEECH = 4;
  // A record of an AI text-based chat interaction.
  AI_TEXT_CHAT_INTERACTION = 5;
  // A record of an on-demand summarization of an AI text chat.
  AI_TEXT_CHAT_SUMMARIZATION = 6;
}

// FileInfo contains details about a generated file artifact.
message RoomArtifactFileInfo {
  string file_path = 1;
  int64 file_size = 2;
  string mime_type = 3;
}

// ProviderJobInfo contains details about an asynchronous job sent to a provider.
message RoomArtifactProviderJobInfo {
  string job_id = 1;
  string file_name = 2;
}

// UserInfo contains details about the user associated with an artifact.
message RoomArtifactUserInfo {
  string user_id = 1;
  optional string name = 2;
}

message RoomArtifactTokenUsage {
  uint32 prompt_tokens = 1;
  uint32 completion_tokens = 2;
  uint32 total_tokens = 3;
  // Optional: A detailed breakdown of token usage.
  // The key could be a user_id, task_type, etc.
  map<string, int64> breakdown = 4;
}

// DurationUsage contains duration usage for a service (e.g., STT).
message RoomArtifactDurationUsage {
  // Duration in seconds.
  uint32 duration_sec = 1;
  // Optional: A detailed breakdown of duration usage.
  // The key could be a user_id, language_code, etc.
  map<string, int64> breakdown = 2;
}

// RoomArtifactCharacterCountUsage contains character count usage statistics.
message RoomArtifactCharacterCountUsage {
  uint32 total_characters = 1;
  // Optional: A detailed breakdown of character usage.
  // The key could be a user_id, language_code, etc.
  map<string, int64> breakdown = 2;
}

// RoomArtifactMetadata is the universal structure for the 'metadata' JSON field
// in the pnm_room_artifacts table. All fields are optional.
message RoomArtifactMetadata {
  // Optional: Information about the user who initiated or is associated with the artifact.
  RoomArtifactUserInfo user_info = 1;

  // Optional: Information about an asynchronous provider job.
  RoomArtifactProviderJobInfo provider_job_info = 2;

  // Optional: Information about the final generated file artifact.
  RoomArtifactFileInfo file_info = 3;

  // A field for different types of usage metrics.
  oneof usage_details {
    RoomArtifactTokenUsage token_usage = 4;
    RoomArtifactDurationUsage duration_usage = 5;
    RoomArtifactCharacterCountUsage character_count_usage = 6;
  }
}

// Webhook-specific Messages
message RoomArtifactWebhookEvent {
  RoomArtifactType type = 1;
  string artifact_id = 2;
  RoomArtifactMetadata metadata = 3;
}
